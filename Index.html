<!-- 1. index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" sizes="192x192" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABl5+JHAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVR4nO3aQU7DMBRF0a3//5w2nq2k4H2mV3j0jQ0S1iK0q6g9j5y1mM1Q0w5r3fK6wCw8nqKZ7f8A0n0bJ0wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABxKp0y8c2G6p9fQW2x9g5W4w3w8p0m5bV+2m2l4z3mWZ8S3+2tG8m8xwRz2cO0zP2gY2mM1w1m2k+8c0u8s8h0d0tq7x9wP4m9e8b0d8q5x8Jgk8a7kzq3rA9+QmVg5Zl0bOweU0v5k2bQ8e5i1r4O1O71k1hYHq8b3C6Xk6sQq3vG6Tg6cQr3vW7Tg6cQr3vW7Tg6cQr3vW7Tg6cQhW9+7m6i6cQk3+0b0r5c4YwVx9G2h9cYYeV0fY4YWZ0PY4YWZ0PY4YWZ0PZ4YabWbPp0f4d2gqfP0b9c4XyZ7D7QbQ6cP4b9cYXyY7j/QbY7cPob/cYXyY6j/Qb4+fPwJ5f7p1v7c2c9bN3m3T2l2a7uT1tav8k7cFYVYVYVYVYVYVYVYVYVYfXJ0+3l+qv2w7Oa4s3m2y9m5n9v3b9x2c9X8wP8K0dYVYVYVYVYVYVYVYVYVbV+XH9w9+3mTt9/7b7b3wO8Bz+1wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL8AX0h1f3qZ4cQAAAABJRU5ErkJggg==" />
  <link rel="stylesheet" href="styles.css" />
  <title>Lagerverwaltung (PWA, offline)</title>
  <meta name="description" content="Offline-f√§hige Lagerverwaltungs-App (Wareneingang, Fotos, Zeichnungsstatus, Buchungsstatus, tempor√§rer Lagerort, CSV/PDF-Export, Background-Sync)." />
</head>
<body>
  <header class="topbar">
    <div class="brand">üì¶ Lagerverwaltung</div>
    <nav class="actions">
      <button id="btn-export-csv" class="btn primary">CSV Export</button>
      <button id="btn-export-pdf" class="btn">PDF Export</button>
      <button id="btn-settings" class="btn ghost" title="Einstellungen">‚öôÔ∏è</button>
      <button id="btn-admin" class="btn ghost" title="Admin-Login">üîí</button>
      <button id="btn-install" class="btn success" hidden>App installieren</button>
    </nav>
  </header>

  <main class="wrap">
    <section class="tabs">
      <button class="tab active" data-tab="ohne">Wareneingang ‚Äî ohne Zeichnung</button>
      <button class="tab" data-tab="mit">Wareneingang ‚Äî mit Zeichnung</button>
      <button class="tab" data-tab="lager">Lager & Bewegungen</button>
      <button class="tab" data-tab="berichte">Berichte</button>
    </section>

    <!-- Wareneingang: Form -->
    <section id="tab-ohne" class="panel active">
      <h2>Wareneingang ohne Zeichnung</h2>
      <form id="form-inbound-ohne" class="card form-grid" autocomplete="off">
        <div><label>Lieferant</label><input required name="supplier" /></div>
        <div><label>Lieferscheinnr.</label><input required name="docNo" /></div>
        <div><label>Tempor√§rer Lagerort</label><input name="tempLocation" placeholder="z. B. Regal A-3" /></div>
        <div class="row">
          <button type="button" class="btn" data-photo="temp">üì∑ Foto Lagerort</button>
          <button type="button" class="btn" data-photo="doc">üì∑ Lieferschein-Fotos</button>
        </div>
        <fieldset class="items">
          <legend>Positionen</legend>
          <div class="items-head">
            <span>Artikel-Nr.</span><span>Menge</span><span>Scan</span><span></span>
          </div>
          <div class="items-body" id="oi-body"></div>
          <div class="items-foot">
            <button type="button" class="btn" id="oi-add">‚ûï Position</button>
          </div>
        </fieldset>
        <div class="row end">
          <button class="btn primary" type="submit">Speichern (ungebucht)</button>
        </div>
      </form>
      <div class="list-wrap">
        <h3>Offene Wareneing√§nge (ungebucht)</h3>
        <div id="list-ohne" class="cards"></div>
      </div>
    </section>

    <section id="tab-mit" class="panel">
      <h2>Wareneingang mit Zeichnung</h2>
      <form id="form-inbound-mit" class="card form-grid" autocomplete="off">
        <div><label>Lieferant</label><input required name="supplier" /></div>
        <div><label>Lieferscheinnr.</label><input required name="docNo" /></div>
        <div><label>Tempor√§rer Lagerort</label><input name="tempLocation" placeholder="z. B. √úbergabe-Palette 2" /></div>
        <div class="row">
          <button type="button" class="btn" data-photo="temp">üì∑ Foto Lagerort</button>
          <button type="button" class="btn" data-photo="doc">üì∑ Lieferschein-Fotos</button>
        </div>
        <fieldset class="items">
          <legend>Positionen</legend>
          <div class="items-head">
            <span>Artikel-Nr.</span><span>Menge</span><span>Scan</span><span></span>
          </div>
          <div class="items-body" id="mi-body"></div>
          <div class="items-foot">
            <button type="button" class="btn" id="mi-add">‚ûï Position</button>
          </div>
        </fieldset>
        <div class="row end">
          <button class="btn primary" type="submit">Speichern (ungebucht)</button>
        </div>
      </form>
      <div class="list-wrap">
        <h3>Offene Wareneing√§nge (ungebucht, mit Zeichnung)</h3>
        <div id="list-mit" class="cards"></div>
      </div>
    </section>

    <!-- Lager / Drag & Drop -->
    <section id="tab-lager" class="panel">
      <h2>Lager & Bewegungen</h2>
      <div class="row gap">
        <div class="card w-50">
          <div class="row between">
            <h3>Verf√ºgbare Positionen (ziehbar)</h3>
            <button id="btn-refresh" class="btn ghost">‚Üª</button>
          </div>
          <div id="stock-pool" class="pool"></div>
        </div>
        <div class="card w-50">
          <div class="row between">
            <h3>Lagerorte</h3>
            <button id="btn-add-location" class="btn">‚ûï Lagerort</button>
          </div>
          <div id="locations" class="locations"></div>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <h3>Bewegungsverlauf</h3>
          <div class="row gap">
            <input id="filter-q" placeholder="Filtern (Art.-Nr. / Ort / User)" />
            <button id="btn-clear-moves" class="btn danger">Verlauf leeren (Admin)</button>
          </div>
        </div>
        <table class="table" id="moves-table">
          <thead><tr><th>Zeit</th><th>Art.-Nr.</th><th>Menge</th><th>von</th><th>nach</th><th>User</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Berichte -->
    <section id="tab-berichte" class="panel">
      <h2>Berichte</h2>
      <div class="card">
        <div class="row gap wrap">
          <button class="btn" id="btn-report-inbound">Report: Wareneing√§nge</button>
          <button class="btn" id="btn-report-stock">Report: Bestand</button>
          <button class="btn" id="btn-report-moves">Report: Bewegungen</button>
          <small>PDF-Export nutzt die Druckansicht des Browsers (ohne Fremdbibliotheken).</small>
        </div>
        <div id="print-root" class="print-root"></div>
      </div>
    </section>
  </main>

  <!-- Dialoge / Modals -->
  <dialog id="dlg-settings" class="modal">
    <form method="dialog" class="card">
      <h3>Einstellungen</h3>
      <label class="block">Optionale WebSocket-URL (z. B. wss://‚Ä¶)
        <input id="set-ws" placeholder="leer lassen f√ºr offline" />
      </label>
      <label class="block">Admin-PIN setzen/√§ndern (4‚Äì8 Ziffern)
        <input id="set-pin" type="password" inputmode="numeric" pattern="[0-9]{4,8}" />
      </label>
      <div class="row end gap">
        <button class="btn ghost" value="cancel">Abbrechen</button>
        <button class="btn primary" id="save-settings" value="ok">Speichern</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlg-qty" class="modal">
    <form method="dialog" class="card">
      <h3>Teilmenge bewegen</h3>
      <label class="block">Menge
        <input id="move-qty" type="number" min="1" step="1" required />
      </label>
      <div class="row end gap">
        <button class="btn ghost" value="cancel">Abbrechen</button>
        <button class="btn primary" value="ok">Bewegen</button>
      </div>
    </form>
  </dialog>

  <dialog id="dlg-login" class="modal">
    <form method="dialog" class="card">
      <h3>Admin-Login</h3>
      <label class="block">PIN
        <input id="pin-in" type="password" inputmode="numeric" pattern="[0-9]{4,8}" required />
      </label>
      <div class="row end gap">
        <button class="btn ghost" value="cancel">Abbrechen</button>
        <button class="btn primary" id="login-ok" value="ok">Einloggen</button>
      </div>
    </form>
  </dialog>

  <!-- Kamera Overlay -->
  <div id="camera" class="camera" hidden>
    <div class="camera-bar">
      <span id="camera-title">Kamera</span>
      <button id="camera-close" class="btn ghost">‚úñ</button>
    </div>
    <video id="cam-video" autoplay playsinline></video>
    <div class="camera-actions">
      <button id="btn-snap" class="btn primary large">‚óè Aufnehmen</button>
      <button id="btn-finish-cam" class="btn">Fertig</button>
    </div>
    <canvas id="cam-canvas" hidden></canvas>
  </div>

  <script src="app.js"></script>
  <script>
    // PWA install prompt handling
    let deferredPrompt;
    const btnInstall = document.getElementById('btn-install');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      btnInstall.hidden = false;
    });
    btnInstall?.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      btnInstall.hidden = true;
    });

    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>
</body>
</html>
